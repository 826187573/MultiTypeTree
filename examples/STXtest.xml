<beast version='2.0'
       namespace='beast.core:beast.core.util:beast.evolution.operators:beast.evolution.likelihood:beast.core.parameter:beast.evolution.tree'>

    <model spec='beast.evolution.migrationmodel.MigrationModel' id="migmodel">
        <rateMatrix spec='RealParameter' value="0.0 0.1 0.1 0.0" minordimension="2"/>
        <popSizes spec="RealParameter" value="7.0 7.0"/>
    </model>

    <run spec="MCMC" id="mcmc" chainLength="20000000"> 

        <init spec='ColouredTreeFromNewick'
                      id="colouredTree" 
                      colourLabel="state" nColours="2" maxBranchColours="100"
                      figtreeCompatible="true">
            <tree id="tree" spec="Tree"/>
            <changeColours id="tree.cols" spec="IntegerParameter" value="0"/>
            <changeTimes id="tree.times"  spec="RealParameter" value="0."/>
            <changeCounts id="tree.counts" spec="IntegerParameter" value="0"/>
            <nodeColours id="tree.nodecols" spec="IntegerParameter" value="0"/>
            <input name="newick">
                ((1[state='0']:1,2[state='0']:1)[state='0']:1,3[state='0']:2)[state='0']:0;
            </input>
        </init>
      
        <state>
            <stateNode idref="tree"/>
            <stateNode idref="tree.cols"/>
            <stateNode idref="tree.times"/>
            <stateNode idref="tree.counts"/>
            <stateNode idref="tree.nodecols"/>
        </state>
        
        <distribution spec="CompoundDistribution" id="P">

            <distribution id='scLikelihood' spec="StructuredCoalescentLikelihood">
                <migrationModel idref="migmodel"/>
                <colouredTree idref="colouredTree"/>
            </distribution>

        </distribution>

        <operator spec='ColouredSubtreeExchangeRandom' id="CSTXR"
                          weight="1" colouredTree="@colouredTree"
                          mu="0.2"/>

        <operator spec='ColouredTreeScale' id="CTS"
                          weight="1" colouredTree='@colouredTree'
                          scaleFactor="1.5"/>

        <logger logEvery="1000" fileName="CWBRtest.log">
            <model idref='P'/>
            <log idref="P"/>
            <log spec='beast.evolution.tree.TreeHeightLogger'>
                <tree idref="tree"/>
            </log>
            <log spec='beast.evolution.tree.ColourChangeCountLogger'>
                <colouredTree idref="colouredTree"/>
            </log>
        </logger>

        <logger logEvery="100000">
            <model idref='P'/>
            <log idref="P"/>
            <log spec='beast.evolution.tree.TreeHeightLogger' >
                <tree idref="tree"/>
            </log>
            <log spec='beast.evolution.tree.ColourChangeCountLogger'>
                <colouredTree idref="colouredTree"/>
            </log>
        </logger>

        <!--
        <logger logEvery="10000" fileName="CWBRtest_col.trees" mode="tree">
            <log idref="colouredTree"/>
        </logger>
        -->

    </run>

</beast>
